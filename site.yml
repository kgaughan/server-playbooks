---
- hosts: all
  remote_user: keith
  become: true
  roles:
    - common
    - tarsnap

- hosts: "!mailservers"
  remote_user: keith
  become: true
  roles:
    - dma

- hosts: dav
  remote_user: keith
  become: true
  roles:
    - dav
  tags:
    - dav

- hosts: feedreaders
  remote_user: keith
  become: true
  roles:
    - feedreader
  tags:
    - feedreader

- hosts: mailservers
  remote_user: keith
  become: true
  roles:
    - mailserver
  tags:
    - mailserver

- hosts: nameservers
  remote_user: keith
  become: true
  roles:
    - nameserver
  tags:
    - nameserver

- hosts: repos
  remote_user: keith
  become: true
  roles:
    - cgit
  tags:
    - repo

- hosts: torrent
  remote_user: keith
  become: true
  roles:
    - torrent
  tags:
    - torrent

- hosts: webmail
  remote_user: keith
  become: true
  roles:
    - webmail
  tags:
    - webmail

- hosts: webservers
  remote_user: keith
  become: true
  roles:
    - webserver
  tags:
    - webserver

# Unlike the others, we need to configure the peers together, so we need to use
# the linear strategy. It'd be nice if the 'meta' module supported a 'sync' or
# 'gather' action that would wait until all machines hit that place in the
# play.
- hosts: wireguard
  remote_user: keith
  become: true
  strategy: linear
  roles:
    - wireguard
  tags:
    - wireguard

---
- name: install user configuration files
  copy:
    src: "home/{{ item }}"
    dest: "/home/keith/.{{ item }}"
    owner: keith
    group: wheel
    mode: 0644
  loop:
    - login_conf
    - nexrc
    - tmux.conf

- name: populate authorized_keys
  authorized_key:
    user: keith
    key: https://github.com/kgaughan.keys
    state: present

- name: ensure timezone is UTC
  timezone:
    name: UTC

- name: install essential packages
  pkgng:
    name:
      - ca_root_nss
      - duff
      - fish
      - pkg-rmleaf
      - pwgen
      - rsync
      - sudo
      - tmux
      - vim-console
    cached: true

- name: include fdesc in fstab
  lineinfile:
    dest: /etc/fstab
    regexp: '^fdesc'
    line: 'fdesc /dev/fd fdescfs rw 0 0'
  notify:
    - mount all

- name: deactivate unwanted services
  service:
    name: "{{ item }}"
    enabled: false
    state: stopped
  loop:
    - moused

- import_tasks: pf.yml
- import_tasks: fbsd-update.yml
- import_tasks: ssh.yml
- import_tasks: ntimed.yml
- import_tasks: sendmail.yml

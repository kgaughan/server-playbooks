---
- name: install packages
  pkgng:
    name:
      - nginx
    cached: true

- name: ensure nginx configuration directories exist
  file:
    name: "{{ webserver_config }}/{{ item }}"
    state: directory
    mode: 0755
  with_items:
    - extra
    - vhosts

- name: ensure log directory exist
  file:
    name: "{{ webserver_logs }}"
    state: directory
    mode: 0755

- name: copy up server config
  copy:
    src: nginx.conf
    dest: "{{ webserver_config }}/"
  notify:
    - reload nginx

- name: copy up common_params
  template:
    src: common_params.j2
    dest: "{{ webserver_config }}/common_params"
  notify:
    - reload nginx

- name: start nginx
  service:
    name: nginx
    enabled: true
    state: started
  ignore_errors: true
